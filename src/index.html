<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>BUILDQUEST NFT BONFIRE METAVERSE</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">


  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
  <script> // front end functionality in here
    function handleClickLogo() { //click logo to go to the home page
      window.location.href = "http://localhost:4200/";
    }
    function handleClickMainBtn() { //click button to open a popup 
      var mainpopup = document.getElementById("mainpopup");
      mainpopup.classList.toggle("show");
    }
    function handleClickBurnBtn() {
       console.log('burn baby burn');
      var burnpopup = document.getElementById("burnpopup");
      burnpopup.classList.toggle("show");
     // approveForRemint();
      reMint();

    }
    function handleClickMercyBtn() {
      console.log('mercy!');
    }


  </script>

  <script>  // was having issues with importing connect.js because the relative path was too secure i think (angular things) only way would be to import in polyfill.ts but web3 isn't working well natively
    Moralis.initialize("5ZAEqifKLbhQ54QMheGJmlxf0s6i4LzfBAOVB8IH"); // Application id from moralis.io
    Moralis.serverURL = "https://8tqclpjg9xnj.usemoralis.com:2053/server"; //Server url from moralis.io

    const testNftContract = "0x9928B8ba18e15B94dB8f19f25b6A5fECFd496543";
    const klimaTokenContract = "0x686CeE3ac8ACEaBf05C8724e5A5C5FE60a0d0Ab8";
    const MemorialNFTContract = "0x0AeEBD7EA21254692991f069Aa4B5FCaF774a5AB";
    const myWallet = "0xe256760b2554AC5950a676cCF3455E4De6ab98aE";



    initalizeWeb3();
    prtTestNfts();
    const web3 = new Web3(window.ethereum);

    async function initalizeWeb3() {
      Moralis.authenticate();
    }


    async function prtTestNfts() {
      await Moralis.start({
        serverUrl: "https://8tqclpjg9xnj.usemoralis.com:2053/server",
        appId: "5ZAEqifKLbhQ54QMheGJmlxf0s6i4LzfBAOVB8IH"
      })

      var ABI = [
        {
          "inputs": [
            {
              "internalType": "address",
              "name": "owner",
              "type": "address"
            }
          ],
          "name": "balanceOf",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function",
          "constant": true
        }
      ];

      const options = {
        chain: "rinkeby",
        address: testNftContract,
        function_name: "balanceOf",
        abi: ABI,
        params: { owner: myWallet }
      }

      const balanceOfTestNft = await Moralis.Web3API.native.runContractFunction(options);
      //console.log(balanceOfTestNft);
      // document.getElementById("oldNftBalance").innerHTML = `<div>You have ${balanceOfTestNft} Test Nfts to Remint </div>`;
      console.log(`You have ${balanceOfTestNft} Test Nfts to Remint `)
    }

    async function approveForRemint() {
       let idForApproval = document.getElementById("testNftId").value;
       console.log("Your ID you clicked to be approved is:" + idForApproval);
      //let idForApproval = 2;

      const options1 = {
        // chain: "rinkeby",
        contractAddress: testNftContract,
        functionName: "approve",
        abi: [{
          "inputs": [
            {
              "internalType": "address",
              "name": "to",
              "type": "address"
            },
            {
              "internalType": "uint256",
              "name": "tokenId",
              "type": "uint256"
            }
          ],
          "name": "approve",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        }],
        params: { to: MemorialNFTContract, tokenId: idForApproval },
      };

      const approve = await Moralis.executeFunction(options1);
      console.log(approve);
    }

    async function sendKlima() {
      let klimaNumbers = document.getElementById("klimaToken").value;
      //console.log(klimaNumbers);

      const options = {
        contractAddress: klimaTokenContract,
        functionName: "transfer",
        abi: [    {
      "inputs": [
        {
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    }],
        params: { to: MemorialNFTContract, amount: klimaNumbers}
      }

      const send = await Moralis.executeFunction(options);
      console.log(send);
    }

    async function reMint() {
     // let NftToMint = document.getElementById("nftID").value;
     // let Klimas = document.getElementById("klimaNumbers").value;
     let nft = 1;
     // console.log(NftToMint);
     // console.log(Klimas);

      const options = {
        contractAddress: MemorialNFTContract,
        functionName: "remint",
        abi: [
        {
      "inputs": [
        {
          "internalType": "address",
          "name": "_oldNFT",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "_id",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "tokensToSend",
          "type": "uint256"
        }
      ],
      "name": "remint",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    }
        ],
      //  msgValue: 10000000000,
        params: {
          _oldNFT: myWallet,
          _id: nft,
          tokensToSend: 100,
        }
      }
      const mint = await Moralis.executeFunction(options);
      console.log(mint);
    }

  </script>

</head>

<body class="bg">
  <div class="ui-container">
    <div class="logo" onclick="handleClickLogo()"></div>
    <div class="popup" id="mainpopup">
      <div class="burn-ui-nft"></div>
      <div class="burn-ui-animation">
        <img id="burnpopup" class="fire" src="assets/prettydisturbed/Burn_animation.gif">
      </div>
      <div class="burn-ui-buttons-container">
        <table>
          <tr>
            <div class="burn-btn" onclick="handleClickBurnBtn()"></div>
            <div class="mercy-btn" onclick="handleClickMercyBtn()"></div>
          </tr>
        </table>
      </div>

    </div>
    <div class="main-btn" onclick="handleClickMainBtn()"></div>
  <app-root></app-root>
</body>


</html>